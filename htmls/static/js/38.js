webpackJsonp([38],{Zq59:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("2Uyi"),i=a("Zq1L"),s=a("KzFb"),o=a("Ntn1"),r={name:"join",components:{clauseAlert:s.a,myAd:o.a},data:function(){return{userInfo:{userName:"",idNo:"",mobile:"",helpType:"1"},planCode:"XL001",alertShow:!1,alertIndex:0,alertChecked:!0,isChecked:!0,adImg:null,authAlertShow:!1,channelType:null,lastUnitAmount:"0.00",lastJoinList:[],lastJoinIndex:0,lastJoinTimer:null,channel:1e4,channelFlag:1,imgsList:[{url:"http://bihu-oss.oss-cn-beijing.aliyuncs.com/images/sina_weibo/DBintroImg10_2x.png?v=1"},{url:"https://imgs.bihubao.com/Public/images/insureAdView/images/DBintroImg4_2x.png"},{url:"https://imgs.bihubao.com/Public/images/insureAdView/images/DBintroImg3_2x.png"}],userPhone:null,amount:3,sex:1}},created:function(){var t=this;this.getPlanState("XL001","join"),this.pageLoad(),this.$route.query.channel?(this.channel=this.$route.query.channel,localStorage.setItem("channel",this.channel)):"undefined"!=localStorage.getItem("channel")&&"null"!=localStorage.getItem("channel")&&(this.channel=localStorage.getItem("channel"),localStorage.setItem("channel",this.channel)),this.$get(i.a.checkRedPacketChannel,{channel:this.channel,isNotshowLoad:"noshow"}).then(function(e){if(0==e.code){var a=e.data.type_list;a.length>0&&a.indexOf("give_score")>-1?(t.channelFlag=2,t.amount=1):(t.channelFlag=1,t.amount=1)}})},methods:{pageLoad:function(){if(this.actionCount("pv"),1==this.$route.query.hasChecked&&this.$post(i.a.subscribe),this.userPhone=this.$route.query.phone||localStorage.getItem("_userPhone"),this.userInfo.userName=this.$route.query.name||"",sessionStorage.getItem("myPlanInfo")){var t=JSON.parse(sessionStorage.getItem("myPlanInfo")).dataList[0].insured;this.userInfo={userName:t.name,idNo:t.idno_init,mobile:this.userPhone||t.mobile,helpType:"1"},this.authAlertShow=!1}else this.getPlanList();this.saveUserPhone(),this.getLastUnitAmount(),console.log("333333333333333333333")},getPlanList:function(){var t=this;this.$get(i.a.getPolicyList,{}).then(function(e){if(0==e.code)if(e.data.policy_list.length>0){var a=e.data.policy_list[0].insured;t.userInfo={userName:a.name,idNo:a.idno_init,mobile:t.userPhone||a.mobile,helpType:"1"}}else t.checkSinaAuth();else t.$toast(e.msg||"请求超时，请刷新重试")})},saveUserPhone:function(){var t=this;this.userInfo.mobile=this.userPhone,this.userPhone?this.$post(i.a.saveUserPhone,{mobile:this.userPhone}):this.$get(i.a.getPhone).then(function(e){0==e.code&&(t.userInfo.mobile=e.data)})},getLastUnitAmount:function(){var t=this;this.$get(i.a.getLastUnitAmount,{plan_code:"XL001"}).then(function(e){0==e.code&&(t.lastUnitAmount=e.data)})},getLastJoinList:function(){var t=this;this.$get(i.a.getLastJoinList).then(function(e){0==e.code&&(t.lastJoinList=e.data.last_join_list,t.txtSrollUp())})},txtSrollUp:function(){var t=this;clearTimeout(this.lastJoinTimer),this.lastJoinTimer=null,this.lastJoinTimer=setTimeout(function(){7==t.lastJoinIndex?t.lastJoinIndex=0:t.lastJoinIndex++,t.txtSrollUp()},1500)},checkSinaAuth:function(){this.$route.query.msg||this.$route.query.button?(this.noAuthEvent(),this.getSinaUserInfo()):(sessionStorage.getItem("_authAlert"),this.authAlertShow=!1)},showAlert:function(t){this.alertIndex=t,this.alertShow=!0},cancelJoin:function(){this.$router.push("/weibo/insure-join")},addJoin:function(){var t=this;if(!this.userInfo.userName)return this.$toast("请填写本人真实姓名"),!1;if(!Object(n.b)(this.userInfo.userName.replace(/\s/g,"")))return this.$toast("只支持中文姓名"),!1;if(this.userInfo.userName.length<2)return this.$toast("本人姓名不得少于两个字符"),!1;if(!this.userInfo.mobile)return this.$toast("请输入手机号"),!1;if(!Object(n.a)(this.userInfo.mobile.replace(/\s/g,"")))return this.$toast("手机号格式不正确"),!1;if(!this.userInfo.idNo)return this.$toast("请输入本人身份证号码"),!1;if(!Object(n.c)(this.userInfo.idNo.replace(/\s/g,"")))return this.$toast("请输入本人正确的身份证号码"),!1;if(!this.alertChecked)return this.$toast("请勾选我已阅读并同意"),!1;var e=this.userInfo.idNo.substring(this.userInfo.idNo.length-2,this.userInfo.idNo.length-1);this.userInfo.helpType=1*this.helpTypeIndex+1,this.actionCount("click");var a=this.channel,s={user_name:this.userInfo.userName.replace(/\s/g,""),certi_no:this.userInfo.idNo.replace(/\s/g,""),mobile:this.userInfo.mobile.replace(/\s/g,""),help_type:1,certi_type:"00",relation:"00",plan_code:this.planCode,work_type:1*this.workTypeIndex+1,channel:a,amount:this.amount};"XL001"==this.planCode&&delete s.work_type,e%2==0?s.deduct_data=[{XL002:{state:2,valid_day:180}}]:this.$post(i.a.joinTicket,{sign:"898c4f832a7337c11dfcd8223afcf07c"}),this.$post(i.a.addPolicy,s).then(function(e){if(0===e.code){t.isChecked?localStorage.setItem("_sendNotice","join"):localStorage.removeItem("_sendNotice"),localStorage.removeItem("_userPhone"),sessionStorage.removeItem("myPlanInfo");var a=localStorage.getItem("_ValentQuery")?JSON.parse(localStorage.getItem("_ValentQuery")):null;a&&a.uid?t.$post(i.a.createRecomRelation,{recommend_id:a.messId||"1",share_uid:a.uid}).then(function(){t.checkStart=e.data.state,t.checkJoin(e.data.state)}):(t.checkStart=e.data.state,t.checkJoin(e.data.state))}else t.$toast(e.msg||"请求失败，请刷新重试")})},checkJoin:function(t){0==t?this.bindWallet():"XL001"==this.planCode?this.$router.replace("/weibo/insure-paysuc"):this.$router.push("/weibo/feiyan-paysuc")},bindWallet:function(){var t=this;this.$post(i.a.bindWallet,{plan_code:this.planCode}).then(function(e){0==e.code?e.data.state&&"not_bind"==e.data.state?(window.location.href=e.data.url,setTimeout(function(){t.$router.replace("/weibo/note-redpacket")},500)):"XL001"==t.planCode?t.$router.replace("/weibo/insure-paysuc"):t.$router.replace("/weibo/feiyan-paysuc"):t.$toast(e.msg||"请求失败，请刷新重试")})},authEvent:function(){this.actionCount("sinaAd_click");var t=window.location,e=t.hostname,a=t.origin,n="localhost"==e?"http://sinatest.bihubao.com/weibo/insure-write":a+this.$route.path;this.$get("https://saas.bihubao.com/contract/misc/getWeiboAuth",{redirect_url:n},!0).then(function(t){window.location.href=t.url})},noAuthEvent:function(){this.authAlertShow=!1,sessionStorage.setItem("_authAlert","hidden")},getSinaUserInfo:function(){var t=this,e=sessionStorage.getItem("weiboInfo")?JSON.parse(sessionStorage.getItem("weiboInfo")).uid:"";this.$jsonp("https://finance.sc.weibo.com/api/authority/request?Appkey=3040890735&uid="+e).then(function(a){if(1e5==a.code){var n=new FormData;n.append("Appkey","3040890735"),n.append("uid",e),n.append("verify",a.data.verify),t.$post("https://saas.bihubao.com/contract/misc/weiboAuthInfo",n,!0,!0).then(function(e){if(1e5==e.code){var a=e.data.userinfo;1e5==a.name.code&&(t.userInfo.userName=e.data.userinfo.name.msg||""),1e5==a.idnum.code&&(t.userInfo.idNo=e.data.userinfo.idnum.msg||"",t.actionCount("sinaAuth_idNo")),1e5==a.mobile.code&&(t.userInfo.mobile=e.data.userinfo.mobile.msg||"")}})}})}},destroyed:function(){clearTimeout(this.lastJoinTimer),this.lastJoinTimer=null}},l={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"sina_page"},[n("div",{staticClass:"join_intro"},[n("transition",{attrs:{name:"fade"}},[t.adImg?n("img",{attrs:{src:t.adImg.img_url}}):t._e()]),t._v(" "),n("div",{staticClass:"sina_hasbg write_bg"},[n("div",{staticClass:"sina_radius_bg join_form"},[n("div",{staticClass:"add_form"},[n("div",{staticClass:"add_title"},[t._v("请填写您的信息")]),t._v(" "),n("div",{staticClass:"input_cells"},[n("div",{staticClass:"sina_input_normal radius"},[n("span",{staticClass:"label"},[t._v("真实姓名:")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.userInfo.userName,expression:"userInfo.userName",modifiers:{trim:!0}}],staticClass:"input_css",attrs:{autocomplete:"off",maxlength:"10",type:"text",placeholder:"请输入真实姓名",value:""},domProps:{value:t.userInfo.userName},on:{input:function(e){e.target.composing||t.$set(t.userInfo,"userName",e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}})]),t._v(" "),n("div",{staticClass:"sina_input_normal radius"},[n("span",{staticClass:"label"},[t._v("身份证号:")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.userInfo.idNo,expression:"userInfo.idNo",modifiers:{trim:!0}}],staticClass:"input_css",attrs:{type:"text",autocomplete:"off",maxlength:"18",placeholder:"请输入身份证号",value:""},domProps:{value:t.userInfo.idNo},on:{input:function(e){e.target.composing||t.$set(t.userInfo,"idNo",e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}})])]),t._v(" "),n("div",{staticClass:"join_desc"},[n("i",{staticClass:"checkbox",class:{checked:t.alertChecked},on:{click:function(e){e.stopPropagation(),t.alertChecked=!t.alertChecked}}}),t._v("\n            我已阅读并同意\n            "),n("a",{staticClass:"col_a",attrs:{href:"javascript:;"},on:{click:function(e){return t.showAlert(1)}}},[t._v("《会员公约》")]),t._v(" "),n("a",{staticClass:"col_a",attrs:{href:"javascript:;"},on:{click:function(e){return t.showAlert(3)}}},[t._v("《授权代扣委托书》")]),t._v(" "),n("a",{staticClass:"col_a",attrs:{href:"javascript:;"},on:{click:function(e){return t.showAlert(0)}}},[t._v("《健康告知》")]),t._v(" "),n("a",{staticClass:"col_a",attrs:{href:"javascript:;"},on:{click:function(e){return t.showAlert(2)}}},[t._v("《计划章程》")]),t._v(" "),n("a",{staticClass:"col_a",attrs:{href:"javascript:;"},on:{click:function(e){return t.showAlert(7)}}},[t._v("《会员隐私政策》")])]),t._v(" "),n("div",{staticClass:"check_box primary bg3",class:{checked:t.isChecked},on:{click:function(e){t.isChecked=!t.isChecked}}},[t._v("\n            发微博邀请更多好友共享互助\n          ")])])]),t._v(" "),n("img",{staticClass:"intro_img",attrs:{src:"http://bihu-oss.oss-cn-beijing.aliyuncs.com/images/sina_weibo/DBWriteIntro.png"}})])],1),t._v(" "),n("div",{staticClass:"sina_img_cells"},[t._l(t.imgsList,function(t,e){return[n("div",{key:"img"+e,staticClass:"sina_img_cell"},[n("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.url,expression:"item.url"}],attrs:{src:t.url}})])]})],2),t._v(" "),n("div",{staticClass:"sina_page_bot"},[1==t.channelFlag?n("div",{staticClass:"bot_desc"},[t._v("\n      预存"+t._s(t.amount)+"元并开通免密支付 返3元互助金\n      ")]):n("div",{staticClass:"bot_desc"},[t._v("\n      预存"+t._s(t.amount)+"元并开通免密支付 返288积分\n    ")]),t._v(" "),n("div",{staticClass:"bot_btns"},[n("div",{staticClass:"bot_btn"},[n("span",{staticClass:"firstLine"},[t._v("预存 "),n("i",[t._v(t._s(t.amount))]),t._v(" 元加入")]),t._v(" "),n("span",{staticClass:"twoLine"},[t._v("预估首期分摊"+t._s(t.lastUnitAmount)+"元")])]),t._v(" "),n("div",{staticClass:"bot_btn primary flex1",on:{click:function(e){return t.addJoin()}}},[t._v("立即加入")])])]),t._v(" "),t.alertShow?n("clause-alert",{attrs:{alertShow:t.alertShow,alertIndex:t.alertIndex},on:{closeClauseAlert:function(e){t.alertShow=!1}}}):t._e(),t._v(" "),t.authAlertShow?n("div",{staticClass:"toast-mask"},[n("div",{staticClass:"img_bg"},[n("img",{attrs:{src:a("a+y6")}}),t._v(" "),n("div",{staticClass:"closebtn",on:{click:t.noAuthEvent}}),t._v(" "),n("button",{staticClass:"sina_btn primary radius auth_btn",on:{click:function(e){return t.authEvent()}}},[t._v("\n        一键加入\n      ")]),t._v(" "),n("button",{staticClass:"noauth_btn",on:{click:function(e){return t.noAuthEvent()}}},[t._v("手动填写")])])]):t._e()],1)},staticRenderFns:[]};var c=a("C7Lr")(r,l,!1,function(t){a("bWAO")},"data-v-923d0522",null);e.default=c.exports},"a+y6":function(t,e,a){t.exports=a.p+"static/img/sinaJoinAlertImg_2x.3ad6750.png"},bWAO:function(t,e,a){var n=a("zg2u");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);a("FIqI")("72c87f04",n,!0,{})},zg2u:function(t,e,a){var n=a("L4zZ");(t.exports=a("UTlt")(!1)).push([t.i,"\n.sina_page[data-v-923d0522]{position:relative;padding-bottom:5.4375rem\n}\n.sina_page .join_intro[data-v-923d0522]{background:#fff\n}\n.sina_page .join_intro .sina_hasbg[data-v-923d0522]{background-repeat:no-repeat;background-size:100% auto;position:relative;padding:7.625rem 1.25rem 0\n}\n.sina_page .join_intro .sina_hasbg .sroll_cells[data-v-923d0522]{text-align:center;height:1.125rem;line-height:1.125rem;overflow:hidden;margin-bottom:0.9375rem;color:#fff\n}\n.sina_page .join_intro .sina_hasbg .sina_radius_bg[data-v-923d0522]{margin:0;padding:0.9375rem 0 1.25rem 1.25rem\n}\n.sina_page .join_intro .sina_hasbg .sina_radius_bg.join_form[data-v-923d0522]{background:-webkit-gradient(linear, left bottom, left top, from(#a5dcff), to(#ffdd84));background:linear-gradient(360deg, #a5dcff, #ffdd84);padding:0.1875rem\n}\n.sina_page .join_intro .sina_hasbg .sina_radius_bg.join_form .add_form[data-v-923d0522]{background:#fff;padding:1.25rem 0.9375rem;border-radius:0.625rem\n}\n.sina_page .join_intro .sina_hasbg .sina_radius_bg.join_form .join_desc[data-v-923d0522]{width:auto;margin:1.4375rem 0.9375rem 0 0.9375rem\n}\n.sina_page .join_intro .sina_hasbg .intro_img[data-v-923d0522]{margin-top:1.375rem\n}\n.sina_page .sina_img_cells .sina_img_cell[data-v-923d0522]{margin-top:0.625rem;background:#fff\n}\n.sina_page .sina_img_cells .sina_img_cell.txt_infos[data-v-923d0522]{margin-top:0.9375rem;padding:0 0.625rem 1.34375rem\n}\n.sina_page .sina_img_cells .sina_img_cell.txt_infos .txt_title[data-v-923d0522]{padding:1.25rem 0 0.5625rem;text-align:center;font-size:1rem\n}\n.sina_page .sina_img_cells .sina_img_cell.txt_infos .txt_desc[data-v-923d0522]{background:#f5f5f9;border-radius:0.625rem;padding:0.625rem 1.25rem;font-size:0.8125rem;line-height:1.25rem\n}\n.sina_page .check_box[data-v-923d0522]{margin:0.5rem 0.9375rem 0.1875rem;color:#507DAF\n}\n.sina_page .add_form[data-v-923d0522]{padding:0.625rem 0 0.625rem 0.9375rem\n}\n.sina_page .add_form .add_title[data-v-923d0522]{text-align:center;font-size:1.25rem;padding-bottom:0.75rem\n}\n.sina_page .myAd[data-v-923d0522]{padding:0.875rem 0.5625rem 0\n}\n.sina_page .sina_page_bot[data-v-923d0522]{width:100%;position:fixed;left:0;bottom:0\n}\n.sina_page .sina_page_bot .bot_desc[data-v-923d0522]{background:#fff8ed;height:1.6875rem;line-height:1.6875rem;text-align:center;color:#ff8200;font-size:0.8125rem\n}\n.sina_page .sina_page_bot .bot_btns[data-v-923d0522]{width:100%;border-top:0.03125rem solid #e6e6e6;background:#fff;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between\n}\n.sina_page .sina_page_bot .bot_btns .bot_btn[data-v-923d0522]{width:10.9375rem;height:3.75rem;padding:0.3125rem 0;font-size:0.75rem;text-align:center;color:#939393;background:#fff\n}\n.sina_page .sina_page_bot .bot_btns .bot_btn .firstLine[data-v-923d0522]{line-height:1.5625rem;color:#333;display:block\n}\n.sina_page .sina_page_bot .bot_btns .bot_btn .firstLine i[data-v-923d0522]{font-style:normal;font-size:1.25rem;color:#ff8200\n}\n.sina_page .sina_page_bot .bot_btns .bot_btn.primary[data-v-923d0522]{background:#ff8200;color:#fff;line-height:3.125rem;font-size:1.25rem\n}\n.sina_page .hasarrow[data-v-923d0522]{padding-right:2.4375rem\n}\n.sina_page .hasarrow.right[data-v-923d0522]::after{right:1.125rem\n}\n.sina_page .hasarrow .type_name[data-v-923d0522]{text-align:right;color:#333\n}\n.toast-mask .img_bg[data-v-923d0522]{width:17.8125rem;position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%, -50%);transform:translate(-50%, -50%)\n}\n.toast-mask .auth_btn[data-v-923d0522]{width:14rem;height:3.125rem;line-height:3.125rem;border-radius:1.59375rem;font-size:1.25rem;border:0;position:absolute;left:50%;-webkit-transform:translateX(-50%);transform:translateX(-50%);bottom:3.6875rem\n}\n.toast-mask .noauth_btn[data-v-923d0522]{width:100%;height:3.125rem;line-height:3.125rem;position:absolute;left:0;bottom:0;background:transparent;color:#939393;font-size:0.875rem;border:0\n}\n.toast-mask .closebtn[data-v-923d0522]{width:2rem;height:2rem;position:absolute;top:-2.75rem;right:0;background-image:url("+n(a("xFVY"))+");background-repeat:no-repeat;background-size:cover;background-position:center 0\n}\n",""])}});